(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-626801e8"],{24442:function(t,e,n){"use strict";n("f447")},"6ab8":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"interface-many-to-many"},[!1===t.relationshipSetup?n("v-notice",{attrs:{color:"warning",icon:"warning"}},[t._v(" "+t._s(t.$t("relationship_not_setup"))+" ")]):t._e(),null===t.initialValue?n("v-spinner"):[t.items&&t.items.length?n("div",{staticClass:"table"},[n("div",{staticClass:"header"},[n("div",{staticClass:"row"},[t.sortable?n("button",{staticClass:"sort-column",on:{click:t.toggleManualSort}},[n("v-icon",{attrs:{name:"sort",small:"",color:t.manualSortActive?"--action":"--blue-grey-300"}})],1):t._e(),n("div",{staticClass:"preview-col"}),t._l(t.visibleFields,(function(e){return n("button",{key:e.field,attrs:{type:"button"},on:{click:function(n){return t.changeSort(e.field)}}},[t._v(" "+t._s(t.$helpers.formatField(e.field,e.collection))+" "),t.sort.field===e.field?n("v-icon",{attrs:{name:t.sort.asc?"arrow_downward":"arrow_upward",size:16}}):t._e()],1)}))],2)]),n("draggable",{staticClass:"body",class:{dragging:t.dragging,readonly:t.readonly},attrs:{handle:".drag-handle",disabled:!t.sortable||!t.manualSortActive},on:{start:function(e){t.dragging=!0},end:function(e){t.dragging=!1}},model:{value:t.itemsSorted,callback:function(e){t.itemsSorted=e},expression:"itemsSorted"}},t._l(t.itemsSorted,(function(e){return n("div",{key:e[t.junctionRelatedKey][t.relatedPrimaryKeyField],staticClass:"row",on:{click:function(n){return t.startEdit(e[t.junctionPrimaryKey])}}},[t.sortable?n("div",{staticClass:"sort-column",class:{disabled:!t.manualSortActive}},[t.readonly?t._e():n("v-icon",{staticClass:"drag-handle",attrs:{name:"drag_handle"}})],1):t._e(),n("v-ext-display",{staticClass:"preview-col",attrs:{"interface-type":"file",name:"thumbnail",collection:"directus_files",type:"JSON",datatype:"TEXT",value:e[t.junctionRelatedKey]}}),t._l(t.visibleFields,(function(i){return n("div",{key:i.field},[n("v-ext-display",{attrs:{"interface-type":i.interface,name:i.field,type:i.type,collection:i.collection,datatype:i.datatype,options:i.options,value:e[t.junctionRelatedKey][i.field]}})],1)})),t.readonly?t._e():n("button",{staticClass:"remove",on:{click:function(n){return n.stopPropagation(),t.deleteItem(e[t.junctionPrimaryKey])}}},[n("v-icon",{attrs:{name:"close"}})],1)],2)})),0)],1):n("v-notice",[t._v(t._s(t.$t("no_items_selected")))]),t.readonly?t._e():n("div",{staticClass:"buttons"},[t.options.allow_create?n("v-button",{attrs:{type:"button",disabled:t.readonly},on:{click:t.startAddNewItem}},[n("v-icon",{attrs:{name:"add",left:""}}),t._v(" "+t._s(t.$t("add_new"))+" ")],1):t._e(),t.options.allow_select?n("v-button",{attrs:{type:"button",disabled:t.readonly},on:{click:function(e){t.selectExisting=!0}}},[n("v-icon",{attrs:{name:"playlist_add",left:""}}),t._v(" "+t._s(t.$t("select_existing"))+" ")],1):t._e()],1)],t.selectExisting?n("v-item-select",{attrs:{fields:t.visibleFieldNames,collection:t.relation.junction.collection_one.collection,filters:[],value:t.stagedSelection||t.selectionPrimaryKeys},on:{input:t.stageSelection,done:t.closeSelection,cancel:t.cancelSelection}}):t._e(),t.addNew?n("portal",{attrs:{to:"modal"}},[n("v-modal",{attrs:{title:t.$t("file_upload"),buttons:{done:{text:t.$t("done")}}},on:{done:function(e){t.addNew=!1},close:function(e){t.addNew=!1}}},[n("div",{staticClass:"upload-modal-body"},[n("v-upload",{attrs:{accept:t.options.accept},on:{upload:t.onFileUpload}})],1)])],1):t._e(),t.editItem?n("portal",{attrs:{to:"modal"}},[n("v-modal",{attrs:{title:t.$t("editing_item"),buttons:{save:{text:t.$t("save"),color:"accent"}}},on:{close:t.closeEditItem,save:t.saveEditItem}},[n("div",{staticClass:"edit-modal-body"},[n("v-form",{attrs:{"new-item":"",fields:t.relation.junction.collection_one.fields,collection:t.relation.junction.collection_one.collection,"primary-key":t.editItem[t.junctionRelatedKey]&&t.editItem[t.junctionRelatedKey][t.relatedPrimaryKeyField]||"+",values:t.editItem[t.junctionRelatedKey]},on:{"stage-value":t.stageValue}})],1)])],1):t._e()],2)},r=[],a=n("0122"),o=n("d0ff"),l=n("c964"),c=n("fc11"),s=n("f3f3"),u=(n("99af"),n("a4d3"),n("e01a"),n("b636"),n("d28b"),n("944a"),n("4de4"),n("7db0"),n("caad"),n("a15b"),n("d81d"),n("fb6a"),n("4e82"),n("b0c0"),n("b64b"),n("0c47"),n("23dc"),n("3410"),n("131a"),n("d3b7"),n("2532"),n("2ca0"),n("3ca3"),n("498a"),n("159b"),n("ddb0"),n("8db2")),d=n.n(u),f=n("649d"),y=n("8dee"),h=n.n(y),m=n("2ef0");function p(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */p=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},l=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function d(t,e,n,i){var a=e&&e.prototype instanceof b?e:b,o=Object.create(a.prototype),l=new L(i||[]);return r(o,"_invoke",{value:E(t,n,l)}),o}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=d;var y="suspendedStart",h="suspendedYield",m="executing",v="completed",g={};function b(){}function j(){}function w(){}var _={};u(_,l,(function(){return this}));var O=Object.getPrototypeOf,K=O&&O(O($([])));K&&K!==n&&i.call(K,l)&&(_=K);var x=w.prototype=b.prototype=Object.create(_);function P(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function n(r,o,l,c){var s=f(t[r],t,o);if("throw"!==s.type){var u=s.arg,d=u.value;return d&&"object"==Object(a["a"])(d)&&i.call(d,"__await")?e.resolve(d.__await).then((function(t){n("next",t,l,c)}),(function(t){n("throw",t,l,c)})):e.resolve(d).then((function(t){u.value=t,l(u)}),(function(t){return n("throw",t,l,c)}))}c(s.arg)}var o;r(this,"_invoke",{value:function(t,i){function r(){return new e((function(e,r){n(t,i,e,r)}))}return o=o?o.then(r,r):r()}})}function E(e,n,i){var r=y;return function(a,o){if(r===m)throw new Error("Generator is already running");if(r===v){if("throw"===a)throw o;return{value:t,done:!0}}for(i.method=a,i.arg=o;;){var l=i.delegate;if(l){var c=F(l,i);if(c){if(c===g)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===y)throw r=v,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=m;var s=f(e,n,i);if("normal"===s.type){if(r=i.done?v:h,s.arg===g)continue;return{value:s.arg,done:i.done}}"throw"===s.type&&(r=v,i.method="throw",i.arg=s.arg)}}}function F(e,n){var i=n.method,r=e.iterator[i];if(r===t)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=t,F(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var a=f(r,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,g;var o=a.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function $(e){if(e||""===e){var n=e[l];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function n(){for(;++r<e.length;)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(Object(a["a"])(e)+" is not iterable")}return j.prototype=w,r(x,"constructor",{value:w,configurable:!0}),r(w,"constructor",{value:j,configurable:!0}),j.displayName=u(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===j||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,s,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},P(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,n,i,r,a){void 0===a&&(a=Promise);var o=new S(d(t,n,i,r),a);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},P(x),u(x,s,"Generator"),u(x,l,(function(){return this})),u(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=$,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(i,r){return l.type="throw",l.arg=e,n.next=i,r&&(n.method="next",n.arg=t),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],l=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=i.call(o,"catchLoc"),s=i.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),I(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;I(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:$(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),g}},e}var v={name:"InterfaceFiles",mixins:[d.a],data:function(){return{sort:{field:null,asc:!0},selectExisting:!1,editItem:!1,addNew:null,dragging:!1,items:null,loading:!1,error:null,stagedSelection:null,initialValue:null}},computed:{relationshipSetup:function(){return!!this.relation},visibleFields:function(){if(!1===this.relationSetup)return[];if(!this.options.fields)return[];var t;Array.isArray(this.options.fields)&&(t=this.options.fields.map((function(t){return t.trim()}))),t=this.options.fields.split(",").map((function(t){return t.trim()}));var e=this.relation.junction.collection_one.fields,n=Object(m["get"])(this.relation,"junction.field_one.field",null);return t.map((function(t){var i=e[t];return n&&t===n&&(i.readonly=!0),i}))},visibleFieldNames:function(){return this.visibleFields.map((function(t){return t.field}))},relatedPrimaryKeyField:function(){return Object(m["find"])(this.relation.junction.collection_one.fields,{primary_key:!0}).field},selectionPrimaryKeys:function(){var t,e=this;return null===(t=this.items)||void 0===t?void 0:t.map((function(t){return t[e.junctionRelatedKey][e.relatedPrimaryKeyField]}))},sortField:function(){var t=this.relation.collection_many.fields,e=Object(m["find"])(t,{type:"sort"});return e},sortable:function(){return!!this.sortField},manualSortActive:function(){return"$manual"===this.sort.field},junctionRelatedKey:function(){return this.relation.junction.field_many.field},junctionPrimaryKey:function(){return Object(m["find"])(this.relation.junction.collection_many.fields,{primary_key:!0}).field},itemsSorted:{get:function(){var t=this;return"$manual"===this.sort.field?Object(m["orderBy"])(Object(m["cloneDeep"])(this.items),(function(e){return e[t.sortField.field]}),this.sort.asc?"asc":"desc"):Object(m["orderBy"])(Object(m["cloneDeep"])(this.items),(function(e){return e[t.junctionRelatedKey][t.sort.field]}),this.sort.asc?"asc":"desc")},set:function(t){var e=this;this.items=t.map((function(t,n){return Object(s["a"])(Object(s["a"])({},t),{},Object(c["a"])({},e.sortField.field,n+1))}))}}},watch:{items:function(t,e){null===e||Object(m["isEqual"])(t,e)||this.emitValue(t)}},created:function(){var t=this;return Object(l["a"])(p().mark((function e(){return p().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.sortable?t.sort.field="$manual":t.visibleFields&&t.visibleFields.length>0&&(t.sort.field=t.visibleFields[0].field),e.next=3,t.getInitialValue();case 3:t.items=(Object(m["cloneDeep"])(t.initialValue)||[]).filter((function(e){return e[t.junctionRelatedKey]}));case 4:case"end":return e.stop()}}),e)})))()},methods:{getInitialValue:function(){var t=this;return Object(l["a"])(p().mark((function e(){var n,i;return p().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=[t.junctionPrimaryKey,t.relation.junction_field+".*"],e.next=3,t.$api.getItems(t.relation.collection_many.collection,{fields:n,filter:Object(c["a"])({},t.relation.field_many.field,t.primaryKey)});case 3:i=e.sent,t.initialValue=i.data;case 5:case"end":return e.stop()}}),e)})))()},changeSort:function(t){this.sort.field!==t?(this.sort.asc=!0,this.sort.field=t):this.sort.asc=!this.sort.asc},startAddNewItem:function(){this.addNew=!0},onFileUpload:function(t){var e=this.relation.junction.collection_one.fields,n=Object(m["mapValues"])(e,(function(t){return t.default_value})),i="$temp_"+h.a.generate();n.hasOwnProperty(this.relatedPrimaryKeyField)&&delete n[this.relatedPrimaryKeyField],this.items=[].concat(Object(o["a"])(this.items),[Object(c["a"])(Object(c["a"])({},this.junctionPrimaryKey,i),this.junctionRelatedKey,t.data)])},stageValue:function(t){var e=t.field,n=t.value;this.$set(this.editItem[this.junctionRelatedKey],e,n)},toggleManualSort:function(){this.sort.field="$manual",this.sort.asc=!0},startEdit:function(t){var e=this;return Object(l["a"])(p().mark((function n(){var i,r,a,o,l,c;return p().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=Object(m["cloneDeep"])(null===(i=e.items)||void 0===i?void 0:i.find((function(n){return n[e.junctionPrimaryKey]===t}))),a="string"===typeof t&&t.startsWith("$temp_"),!1!==a){n.next=9;break}return o=e.relation.collection_many.collection,n.next=6,e.$api.getItem(o,t,{fields:"*.*.*"});case 6:l=n.sent,c=l.data,r=Object(m["merge"])({},c,r);case 9:e.editItem=r;case 10:case"end":return n.stop()}}),n)})))()},saveEditItem:function(){var t,e=this,n=this.editItem[this.junctionPrimaryKey];this.items=null===(t=this.items)||void 0===t?void 0:t.map((function(t){return t[e.junctionPrimaryKey]===n?e.editItem:t})),this.editItem=null},closeEditItem:function(){this.editItem=null},stageSelection:function(t){this.stagedSelection=t},closeSelection:function(){var t=this;return Object(l["a"])(p().mark((function e(){var n,i,r,a,l,s,u,d;return p().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.stagedSelection||[],t.items=null===(n=t.items)||void 0===n?void 0:n.filter((function(e){var n=e[t.junctionRelatedKey][t.relatedPrimaryKeyField];return r.includes(n)})),a=null===(i=t.items)||void 0===i?void 0:i.map((function(e){return e[t.junctionRelatedKey][t.relatedPrimaryKeyField]})),l=Object(m["difference"])(r,a),e.next=6,t.$api.getItem(t.relation.junction.collection_one.collection,l.join(","),{fields:"*.*.*"});case 6:s=e.sent,u=Array.isArray(s.data)?s.data:[s.data],d=null===u||void 0===u?void 0:u.map((function(e){var n="$temp_"+h.a.generate();return Object(c["a"])(Object(c["a"])({},t.junctionPrimaryKey,n),t.junctionRelatedKey,e)})),t.items=[].concat(Object(o["a"])(t.items),Object(o["a"])(d)),t.stagedSelection=null,t.selectExisting=!1;case 12:case"end":return e.stop()}}),e)})))()},cancelSelection:function(){this.stagedSelection=null,this.selectExisting=null},deleteItem:function(t){var e,n=this;this.items=null===(e=this.items)||void 0===e?void 0:e.filter((function(e){var i=e[n.junctionPrimaryKey];return i!==t}))},emitValue:function(t){var e=this;t=Object(m["cloneDeep"])(t);var n=Object(m["get"])(this.relation,"junction.field_one.field",null),i=t.map((function(t){var i=t[e.junctionPrimaryKey],r=e.initialValue.find((function(t){return t[e.junctionPrimaryKey]===i}));if(r){var a=Object(f["diff"])(r,t);if(Object.keys(a).length>0){var o=Object(c["a"])(Object(c["a"])({},e.junctionPrimaryKey,i),e.junctionRelatedKey,Object(c["a"])({},e.relatedPrimaryKeyField,r[e.junctionRelatedKey][e.relatedPrimaryKeyField]));return n&&o[e.junctionRelatedKey].hasOwnProperty(n)&&delete o[e.junctionRelatedKey][n],Object(m["merge"])({},o,a)}return null}return"string"===typeof t[e.junctionPrimaryKey]&&t[e.junctionPrimaryKey].startsWith("$temp_")?Object(c["a"])({},e.junctionRelatedKey,Object(c["a"])({},e.relatedPrimaryKeyField,t[e.junctionRelatedKey][e.relatedPrimaryKeyField])):t})).filter((function(t){return t})),r=this.initialValue.map((function(t){return t[e.junctionPrimaryKey]})),a=t.map((function(t){return t[e.junctionPrimaryKey]})),l=Object(m["difference"])(r,a),s=l.map((function(t){return Object(c["a"])(Object(c["a"])({},e.junctionPrimaryKey,t),"$delete",!0)}));this.$emit("input",[].concat(Object(o["a"])(i),Object(o["a"])(s)))}}},g=v,b=(n("24442"),n("2877")),j=Object(b["a"])(g,i,r,!1,null,"7aed737d",null);e["default"]=j.exports},"8db2":function(t,e){t.exports={props:{id:{type:String,required:!0},name:{type:String,required:!0},value:{type:null,default:null},type:{type:String,required:!0},length:{type:[String,Number],default:null},readonly:{type:Boolean,default:!1},collection:{type:String,default:null},primaryKey:{type:[Number,String],default:null},required:{type:Boolean,default:!1},options:{type:Object,default:()=>({})},newItem:{type:Boolean,default:!1},relation:{type:Object,default:null},fields:{type:Object,default:null},values:{type:Object,default:null},width:{type:String,default:null,validator(t){return["half","half-left","half-right","full","fill"].includes(t)}}}}},f447:function(t,e,n){}}]);
//# sourceMappingURL=chunk-626801e8.fd544aef.js.map