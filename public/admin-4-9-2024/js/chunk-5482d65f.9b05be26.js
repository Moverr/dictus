(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5482d65f"],{"2c47":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"interface-one-to-many"},[!1===t.relationshipSetup?r("v-notice",{attrs:{color:"warning",icon:"warning"}},[t._v(" "+t._s(t.$t("relationship_not_setup"))+" ")]):null===t.initialValue?r("v-spinner"):[t.items&&t.items.length?r("div",{staticClass:"table"},[r("div",{staticClass:"header"},[r("div",{staticClass:"row"},[t.sortable?r("button",{staticClass:"sort-column",on:{click:t.toggleManualSort}},[r("v-icon",{attrs:{name:"sort",small:"",color:t.manualSortActive?"--action":"--blue-grey-300"}})],1):t._e(),t._l(t.visibleFields,(function(e){return r("button",{key:e.field,attrs:{type:"button"},on:{click:function(r){return t.changeSort(e.field)}}},[t._v(" "+t._s(t.$helpers.formatField(e.field,e.collection))+" "),t.sort.field===e.field?r("v-icon",{attrs:{name:t.sort.asc?"arrow_downward":"arrow_upward",size:16}}):t._e()],1)}))],2)]),r("draggable",{staticClass:"body",class:{dragging:t.dragging,readonly:t.readonly},attrs:{handle:".drag-handle",disabled:!t.sortable||!t.manualSortActive},on:{start:function(e){t.dragging=!0},end:function(e){t.dragging=!1}},model:{value:t.itemsSorted,callback:function(e){t.itemsSorted=e},expression:"itemsSorted"}},t._l(t.itemsSorted,(function(e){return r("div",{key:e[t.relatedPrimaryKeyField],staticClass:"row",on:{click:function(r){return t.startEdit(e[t.relatedPrimaryKeyField])}}},[t.sortable?r("div",{staticClass:"sort-column",class:{disabled:!t.manualSortActive}},[t.readonly?t._e():r("v-icon",{staticClass:"drag-handle",attrs:{name:"drag_handle"}})],1):t._e(),t._l(t.visibleFields,(function(t){return r("div",{key:t.field,staticClass:"field-preview"},[r("v-ext-display",{attrs:{"interface-type":t.interface,name:t.field,type:t.type,collection:t.collection,relation:t.relation,datatype:t.datatype,options:t.options,value:String(e[t.field]).startsWith("$temp_")?null:e[t.field],values:e}})],1)})),t.readonly?t._e():r("button",{staticClass:"remove",on:{click:function(r){return r.stopPropagation(),t.deleteItem(e[t.relatedPrimaryKeyField])}}},[r("v-icon",{attrs:{name:"close"}})],1)],2)})),0)],1):r("v-notice",[t._v(t._s(t.$t("no_items_selected")))]),t.readonly?t._e():r("div",{staticClass:"buttons"},[t.options.allow_create?r("v-button",{attrs:{type:"button",disabled:t.readonly},on:{click:t.startAddNewItem}},[r("v-icon",{attrs:{name:"add",left:""}}),t._v(" "+t._s(t.$t("add_new"))+" ")],1):t._e(),t.options.allow_select?r("v-button",{attrs:{type:"button",disabled:t.readonly},on:{click:function(e){t.selectExisting=!0}}},[r("v-icon",{attrs:{name:"playlist_add",left:""}}),t._v(" "+t._s(t.$t("select_existing"))+" ")],1):t._e()],1)],t.selectExisting?r("v-item-select",{attrs:{fields:t.visibleFieldNames,collection:t.relation.collection_many.collection,filters:[],value:t.stagedSelection||t.selectionPrimaryKeys},on:{input:t.stageSelection,done:t.closeSelection,cancel:t.cancelSelection}}):t._e(),t.editItem?r("portal",{attrs:{to:"modal"}},[r("v-modal",{attrs:{title:t.addNew?t.$t("creating_item"):t.$t("editing_item"),buttons:{save:{text:t.$t("save"),color:"accent"}}},on:{close:t.closeEditItem,save:t.saveEditItem}},[r("div",{staticClass:"edit-modal-body"},[r("v-form",{attrs:{"new-item":"",fields:t.relatedCollectionFields,collection:t.relation.collection_many.collection,"primary-key":t.editItem[t.relatedPrimaryKeyField]||"+",values:t.editItem},on:{"stage-value":t.stageValue}})],1)])],1):t._e()],2)},i=[],a=r("0122"),o=r("d0ff"),l=r("c964"),s=r("fc11"),c=r("f3f3"),u=(r("99af"),r("a4d3"),r("e01a"),r("b636"),r("d28b"),r("944a"),r("4de4"),r("7db0"),r("caad"),r("a15b"),r("d81d"),r("fb6a"),r("4e82"),r("b0c0"),r("b64b"),r("0c47"),r("23dc"),r("3410"),r("131a"),r("d3b7"),r("07ac"),r("2532"),r("2ca0"),r("3ca3"),r("498a"),r("159b"),r("ddb0"),r("8db27")),d=r.n(u),f=r("8dee"),h=r.n(f),y=r("649d"),m=r("2ef0");function p(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */p=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},l=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function d(t,e,r,n){var a=e&&e.prototype instanceof b?e:b,o=Object.create(a.prototype),l=new I(n||[]);return i(o,"_invoke",{value:E(t,r,l)}),o}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=d;var h="suspendedStart",y="suspendedYield",m="executing",v="completed",g={};function b(){}function w(){}function _(){}var O={};u(O,l,(function(){return this}));var j=Object.getPrototypeOf,F=j&&j(j($([])));F&&F!==r&&n.call(F,l)&&(O=F);var x=_.prototype=b.prototype=Object.create(O);function S(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function r(i,o,l,s){var c=f(t[i],t,o);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==Object(a["a"])(d)&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,l,s)}),(function(t){r("throw",t,l,s)})):e.resolve(d).then((function(t){u.value=t,l(u)}),(function(t){return r("throw",t,l,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return o=o?o.then(i,i):i()}})}function E(e,r,n){var i=h;return function(a,o){if(i===m)throw new Error("Generator is already running");if(i===v){if("throw"===a)throw o;return{value:t,done:!0}}for(n.method=a,n.arg=o;;){var l=n.delegate;if(l){var s=L(l,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=m;var c=f(e,r,n);if("normal"===c.type){if(i=n.done?v:y,c.arg===g)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=v,n.method="throw",n.arg=c.arg)}}}function L(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,L(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(i,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function K(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function $(e){if(e||""===e){var r=e[l];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(Object(a["a"])(e)+" is not iterable")}return w.prototype=_,i(x,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:w,configurable:!0}),w.displayName=u(_,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,u(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},S(P.prototype),u(P.prototype,s,(function(){return this})),e.AsyncIterator=P,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new P(d(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(x),u(x,c,"Generator"),u(x,l,(function(){return this})),u(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=$,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(K),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return l.type="throw",l.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],l=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),K(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;K(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:$(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}var v={name:"InterfaceOneToMany",mixins:[d.a],data:function(){return{sort:{field:null,asc:!0},selectExisting:!1,editItem:!1,addNew:null,dragging:!1,items:null,loading:!1,error:null,stagedSelection:null,initialValue:null}},computed:{relationshipSetup:function(){return!!this.relation},visibleFields:function(){var t=this;if(!1===this.relationshipSetup)return[];var e,r=this.relation.collection_many.fields,n=this.relation.field_many.field;return this.options.fields?(Array.isArray(this.options.fields)&&(e=this.options.fields.map((function(t){return t.trim()}))),e=this.options.fields.split(",").map((function(t){return t.trim()})),e.map((function(e){var i=r[e];n&&e===n&&(i.readonly=!0);var a=null;return"m2o"===i.type.toLowerCase()&&(a=t.$store.getters.m2o(i.collection,i.field)),"o2m"===i.type.toLowerCase()&&(a=t.$store.getters.o2m(i.collection,i.field)),"translation"===i.type.toLowerCase()&&(a=t.$store.getters.o2m(i.collection,i.field)),i.relation=a,i}))):Object.values(r).filter((function(t){return!0!==t.hidden_browse})).filter((function(t){return!n||t.field!==n})).slice(0,2)},visibleFieldNames:function(){return this.visibleFields.map((function(t){return t.field}))},relatedPrimaryKeyField:function(){return Object(m["find"])(this.relation.collection_many.fields,{primary_key:!0}).field},selectionPrimaryKeys:function(){var t=this;return this.items.map((function(e){return e[t.relatedPrimaryKeyField]}))},sortField:function(){var t=this.options.sort_field;return t?Object(m["find"])(this.relation.collection_many.fields,{field:t}):null},sortable:function(){return!!this.sortField},manualSortActive:function(){return"$manual"===this.sort.field},relatedCollectionFields:function(){var t=this.relation.collection_many.fields,e=this.relation.field_many&&this.relation.field_many.field;return Object(m["mapValues"])(t,(function(t){var r=Object(m["clone"])(t);return r.field===e&&(r.readonly=!0),r}))},itemsSorted:{get:function(){var t=this;return"$manual"===this.sort.field?Object(m["orderBy"])(Object(m["cloneDeep"])(this.items),(function(e){return e[t.sortField.field]}),this.sort.asc?"asc":"desc"):Object(m["orderBy"])(Object(m["cloneDeep"])(this.items),(function(e){return e[t.sort.field]}),this.sort.asc?"asc":"desc")},set:function(t){var e=this;this.items=t.map((function(t,r){return Object(c["a"])(Object(c["a"])({},t),{},Object(s["a"])({},e.sortField.field,r+1))}))}}},watch:{items:function(t,e){null!==e&&this.emitValue(t)}},created:function(){var t=this;return Object(l["a"])(p().mark((function e(){return p().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.sortable?t.sort.field="$manual":t.visibleFieldNames&&t.visibleFieldNames.length>0&&(t.sort.field=t.visibleFieldNames[0]),e.next=3,t.getInitialValue();case 3:t.items=Object(m["cloneDeep"])(t.initialValue)||[];case 4:case"end":return e.stop()}}),e)})))()},methods:{getInitialValue:function(){var t=this;return Object(l["a"])(p().mark((function e(){var r;return p().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$api.getItems(t.relation.collection_many.collection,{fields:"*.*",filter:Object(s["a"])({},t.relation.field_many.field,t.primaryKey)});case 2:r=e.sent,t.initialValue=r.data;case 4:case"end":return e.stop()}}),e)})))()},changeSort:function(t){this.sort.field!==t?(this.sort.asc=!0,this.sort.field=t):this.sort.asc=!this.sort.asc},toggleManualSort:function(){this.sort.field="$manual",this.sort.asc=!0},startAddNewItem:function(){this.addNew=!0;var t=this.relation.collection_many.fields,e=Object(m["mapValues"])(t,(function(t){return t.default_value})),r=this.relation.field_many&&this.relation.field_many.field,n="$temp_"+h.a.generate();e.hasOwnProperty(this.relatedPrimaryKeyField)&&delete e[this.relatedPrimaryKeyField],e.hasOwnProperty(r)&&delete e[r],this.items=[].concat(Object(o["a"])(this.items),[Object(c["a"])(Object(s["a"])({},this.relatedPrimaryKeyField,n),e)]),this.startEdit(n)},stageValue:function(t){var e=t.field,r=t.value;this.$set(this.editItem,e,r)},startEdit:function(t){var e=this;return Object(l["a"])(p().mark((function r(){var n,i,a,o,l;return p().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=Object(m["cloneDeep"])(e.items.find((function(r){return r[e.relatedPrimaryKeyField]===t}))),i="string"===typeof t&&t.startsWith("$temp_"),!1!==i){r.next=9;break}return a=e.relation.collection_many.collection,r.next=6,e.$api.getItem(a,t,{fields:"*.*"});case 6:o=r.sent,l=o.data,n=Object(m["merge"])({},l,n);case 9:e.editItem=n;case 10:case"end":return r.stop()}}),r)})))()},saveEditItem:function(){var t=this,e=this.editItem[this.relatedPrimaryKeyField],r=this.relation.field_many&&this.relation.field_many.field;this.items=this.items.map((function(n){if(n[t.relatedPrimaryKeyField]===e){var i=Object(m["clone"])(t.editItem);return i.hasOwnProperty(r)&&delete i[r],i}return n})),this.editItem=null},closeEditItem:function(){this.addNew&&this.items.pop(),this.addNew=!1,this.editItem=null},stageSelection:function(t){this.stagedSelection=t},closeSelection:function(){var t=this;return Object(l["a"])(p().mark((function e(){var r,n,i,a,l;return p().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.stagedSelection){e.next=3;break}return t.selectExisting=!1,e.abrupt("return");case 3:if(r=t.stagedSelection||[],t.items=t.items.filter((function(e){var n=e[t.relatedPrimaryKeyField];return r.includes(n)})),n=t.items.map((function(e){return e[t.relatedPrimaryKeyField]})),i=Object(m["difference"])(r,n),!(i.length>0)){e.next=13;break}return e.next=10,t.$api.getItem(t.relation.collection_many.collection,i.join(","),{fields:"*.*.*"});case 10:a=e.sent,l=Array.isArray(a.data)?a.data:[a.data],t.items=[].concat(Object(o["a"])(t.items),Object(o["a"])(l));case 13:t.stagedSelection=null,t.selectExisting=!1;case 15:case"end":return e.stop()}}),e)})))()},cancelSelection:function(){this.stagedSelection=null,this.selectExisting=!1},deleteItem:function(t){var e=this;this.items=this.items.filter((function(r){return r[e.relatedPrimaryKeyField]!==t}))},emitValue:function(t){var e=this;t=Object(m["cloneDeep"])(t);var r=this.relation.field_many.field,n=t.map((function(t){var n=t[e.relatedPrimaryKeyField],i=e.initialValue.find((function(t){return t[e.relatedPrimaryKeyField]===n}));if(i){var a=Object(y["diff"])(i,t);if(Object(m["forEach"])(a,(function(r,n){var i=e.relatedCollectionFields[n];if(i){var o=i.type.toLowerCase();"json"!==o&&"translation"!==o&&"array"!==o&&"translation"!==o&&"o2m"!==o||(a[n]=t[n])}})),Object.keys(a).length>0){var o=Object(s["a"])({},e.relatedPrimaryKeyField,i[e.relatedPrimaryKeyField]);return r&&o[e.relatedPrimaryKeyField].hasOwnProperty(r)&&delete o[r],Object(m["merge"])({},o,a)}return null}return r&&t.hasOwnProperty(r)&&delete t[r],"string"===typeof t[e.relatedPrimaryKeyField]&&t[e.relatedPrimaryKeyField].startsWith("$temp_")&&delete t[e.relatedPrimaryKeyField],t})).filter((function(t){return t})),i=this.initialValue.map((function(t){return t[e.relatedPrimaryKeyField]})),a=t.map((function(t){return t[e.relatedPrimaryKeyField]})),l=Object(m["difference"])(i,a),c=l.map((function(t){return"relation"===e.options.delete_mode?Object(s["a"])(Object(s["a"])({},e.relatedPrimaryKeyField,t),r,null):Object(s["a"])(Object(s["a"])({},e.relatedPrimaryKeyField,t),"$delete",!0)}));this.$emit("input",[].concat(Object(o["a"])(n),Object(o["a"])(c)))}}},g=v,b=(r("b531"),r("2877")),w=Object(b["a"])(g,n,i,!1,null,"75f37f4c",null);e["default"]=w.exports},3420:function(t,e,r){},"8db27":function(t,e){t.exports={props:{id:{type:String,required:!0},name:{type:String,required:!0},value:{type:null,default:null},type:{type:String,required:!0},length:{type:[String,Number],default:null},readonly:{type:Boolean,default:!1},collection:{type:String,default:null},primaryKey:{type:[Number,String],default:null},required:{type:Boolean,default:!1},options:{type:Object,default:()=>({})},newItem:{type:Boolean,default:!1},relation:{type:Object,default:null},fields:{type:Object,default:null},values:{type:Object,default:null},width:{type:String,default:null,validator(t){return["half","half-left","half-right","full","fill"].includes(t)}}}}},b531:function(t,e,r){"use strict";r("3420")}}]);
//# sourceMappingURL=chunk-5482d65f.9b05be26.js.map